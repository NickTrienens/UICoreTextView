<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>UICoreTextView by giladno</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>UICoreTextView</h1>
        <h2>Easy to use UIView which supports rendering using CoreText</h2>
        <a href="https://github.com/giladno/UICoreTextView" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>CoreTextView</h1>

<p><img src="https://raw.github.com/giladno/UICoreTextView/gh-pages/images/screenshot.png"></p>

<h1>Overview</h1>

<p>iOS controls (such as <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/UILabel_Class/Reference/UILabel.html#//apple_ref/occ/instp/UILabel/attributedText">UILabel</a> and <a href="http://developer.apple.com/library/ios/#documentation/uikit/reference/uitextview_class/Reference/UITextView.html#//apple_ref/occ/instp/UITextView/attributedText">UITextView</a>) already support NSAttributedString, but CoreTextView offers much more than simple styling.
If your app needs to render both text &amp; images, or have some custom rendering on the fly - then CoreTextView is for you.</p>

<p>There is another great core text library by Oliver Drobnik: <a href="https://github.com/Cocoanetics/DTCoreText">DTCoreText</a>. My goal was to create a very tiny and easy to use component (2 files only!) which is meant for simple tasks. If you really need full control of your output, I suggest to take a look at DTCoreText.</p>

<p>CoreTextView contains 2 major components:</p>

<ul>
<li>
<b>CoreTextView</b> - UIView based, used to render the string</li>
<li>
<b>HTMLParser</b> - HTML parser which generates an instance of NSAttributedString. There is also a category for NSAttributedString, for easy creation of NSAttributedString objects.</li>
</ul><h2>Examples</h2>

<p>Please also refer to the demo project for a working demo.</p>

<h4>Basic styling</h4>

<div class="highlight"><pre><span class="n">m_coreText</span><span class="p">.</span><span class="n">attributedString</span><span class="o">=</span><span class="p">[</span><span class="n">NSAttributedString</span> <span class="nl">attributedStringWithHTML:</span><span class="s">@"&lt;span font='Papyrus' size='12' color='rgba(255,0,255,0.5)'&gt;This is a styled string&lt;/span&gt;"</span><span class="p">];</span>
</pre></div>

<h4>Custom Rendering</h4>

<h6>50x50 Blue circle renderer</h6>

<div class="highlight"><pre><span class="k">@interface</span> <span class="nc">BlueCircle</span> : <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">HTMLRenderer</span><span class="o">&gt;</span>
<span class="k">@end</span>

<span class="err">@</span><span class="n">implementation</span> <span class="n">BlueCircle</span>
<span class="o">-</span><span class="p">(</span><span class="n">CGSize</span><span class="p">)</span><span class="n">size</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="p">}</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">renderInContext:</span><span class="p">(</span><span class="n">CGContextRef</span><span class="p">)</span><span class="n">context</span> <span class="nl">rect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="n">rect</span>
<span class="p">{</span>
    <span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
    <span class="n">CGContextFillEllipseInRect</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">rect</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div>

<h6>Using the renderer callback</h6>

<div class="highlight"><pre><span class="n">NSString</span><span class="o">*</span> <span class="n">html</span><span class="o">=</span><span class="s">@"DIV elements generate custom renderers: &lt;div /&gt;"</span><span class="p">;</span>
<span class="n">m_coreText</span><span class="p">.</span><span class="n">attributedString</span><span class="o">=</span><span class="p">[</span><span class="n">NSAttributedString</span> <span class="nl">attributedStringWithHTML:</span><span class="n">html</span> <span class="nl">renderer:</span><span class="o">^</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">HTMLRenderer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">NSMutableDictionary</span><span class="o">*</span> <span class="n">attributes</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">BlueCircle</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
<span class="p">}];</span>
</pre></div>

<h2>Styling</h2>

<p>Since CoreTextView was designed mainly to work with custom renderers - passing attributes from the HTML to the callback should be as simple as possible. For that reason, the syntax is based on plain old HTML tags and not modern CSS. The callback receives an instance of NSMutableAttributes, which contains all available attributes of that HTML node.</p>

<p>The syntax was meant to be as simple as possible and at no point was it designed to follow HTML standards. For that reason, some of the HTML tags/attributes might differ from the original specs (for example, &lt;s&gt; for stroke rather than &lt;stroke&gt;)</p>

<h3>Text</h3>

<div class="highlight"><pre><span class="nt">&lt;span</span> <span class="na">font=</span><span class="s">'ArialMT|Georgia|noorehira|...'</span> <span class="na">size=</span><span class="s">'16'</span><span class="nt">&gt;</span>Font manipulation, we can change font name and size<span class="nt">&lt;/font&gt;</span>

<span class="nt">&lt;b&gt;</span>Bold&gt;
<span class="nt">&lt;u</span> <span class="na">style=</span><span class="s">'none|single|thick|double'</span><span class="nt">&gt;</span>Underline<span class="nt">&lt;/u&gt;</span>
<span class="nt">&lt;i&gt;</span>Italic<span class="nt">&lt;/i&gt;</span>
<span class="nt">&lt;s</span> <span class="na">width=</span><span class="s">'3'</span> <span class="na">color=</span><span class="s">'rgb(255,0,0)'</span><span class="nt">&gt;</span>Red stroke<span class="nt">&lt;/s&gt;</span>

<span class="nt">&lt;span</span> <span class="na">align=</span><span class="s">'natural|left|right|center|justified'</span><span class="nt">&gt;</span>Aligned text<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">direction=</span><span class="s">'rtl|ltr'</span><span class="nt">&gt;</span>RTL or LTR text<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">wrap=</span><span class="s">'word|break-word|clip|ellipsis-head|ellipsis-tail|ellipsis-middle'</span><span class="nt">&gt;</span>Wrapped text<span class="nt">&lt;/span&gt;</span>
</pre></div>

<h3>Colors</h3>

<div class="highlight"><pre><span class="nt">&lt;span</span> <span class="na">color=</span><span class="s">'#FF0000'</span><span class="nt">&gt;</span>Standard HTML colors<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">color=</span><span class="s">'rgb(255,0,0)'</span><span class="nt">&gt;</span>RGB color<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;span</span> <span class="na">color=</span><span class="s">'rgba(255,0,0,0.5)'</span><span class="nt">&gt;</span>RGBA color<span class="nt">&lt;/span&gt;</span>
</pre></div>

<h3>Links</h3>

<p>By default, all links will render using a blue color and a single underline (which you can override using the <code>color</code> tag and an embedded <code>u</code> tag).
CoreTextView will try by default to open any link using <code>[[UIApplication sharedApplication] openURL:url]</code>. You can prevent this behaviour by returning YES from <code>-(BOOL)coreTextView:(CoreTextView*)view openURL:(NSURL*)url</code> delegate.</p>

<div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'http://www.google.com/'</span><span class="nt">&gt;</span>Google.com<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'tel:+180012345678'</span><span class="nt">&gt;</span>Click to call<span class="nt">&lt;/a&gt;</span>
</pre></div>

<h3>Images</h3>

<p>Images can be embedded using the <b>base64:</b> prefix or be loaded from disk. Images will be loaded using <code>[UIImage imageNamed:src]</code> - unless the <b>file://</b> scheme is specified.
For images, you can also use the <code>valign='middle'</code> attribute to center them vertically.</p>

<div class="highlight"><pre><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'base64:iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=='</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">width=</span><span class="s">'50'</span> <span class="na">height=</span><span class="s">'50'</span> <span class="na">src=</span><span class="s">'avatar.png'</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'file://..../house.jpg'</span> <span class="na">valign=</span><span class="s">'middle'</span> <span class="nt">/&gt;</span>
</pre></div>

<h3>Others</h3>

<div class="highlight"><pre><span class="nt">&lt;br&gt;</span>
<span class="nt">&lt;hr</span> <span class="na">height=</span><span class="s">'5'</span> <span class="na">color=</span><span class="s">'#FF0000'</span> <span class="nt">/&gt;</span>
</pre></div>

<h2>Custom Renderer</h2>

<p>Sometimes your app needs to render some content dynamically. One option would be to generate an image and create a new NSAttributedString every time - or you can use a custom renderer.</p>

<p>Custom renderers use a callback, passing a graphic context to draw into. An app can then use it to draw whatever it needs.</p>

<p>To create a custom renderer, simply use a <code>div</code> tag inside your HTML. You can also set custom attributes which will be passed to the renderer factory. Custom attributes allow you to distinguish between different renderers in the same HTML.</p>

<p>To be able to create a custom renderer, you'll need to pass a callback to the HTML parser:</p>

<div class="highlight"><pre><span class="n">NSString</span><span class="o">*</span> <span class="n">html</span><span class="o">=</span><span class="s">@"&lt;div type='square' /&gt;&lt;div type='circle' /&gt;"</span><span class="p">;</span>
<span class="n">m_coreText</span><span class="p">.</span><span class="n">attributedString</span><span class="o">=</span><span class="p">[</span><span class="n">NSAttributedString</span> <span class="nl">attributedStringWithHTML:</span><span class="n">html</span> <span class="nl">renderer:</span><span class="o">^</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">HTMLRenderer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">NSMutableDictionary</span><span class="o">*</span> <span class="n">attributes</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">attributes</span><span class="p">[</span><span class="s">@"type"</span><span class="p">]</span> <span class="nl">isEqualToString:</span><span class="s">@"circle"</span><span class="p">])</span>
    <span class="p">{</span>
    <span class="p">...</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">m_customRenderer</span><span class="p">;</span>
<span class="p">}];</span>
</pre></div>

<p>A custom renderer can be any object defining the <code>HTMLRenderer</code> protocol:</p>

<div class="highlight"><pre><span class="k">@protocol</span> <span class="nc">HTMLRenderer</span><span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="err">@</span><span class="n">required</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">readonly</span><span class="p">)</span> <span class="n">CGSize</span> <span class="n">size</span><span class="p">;</span>
<span class="err">@</span><span class="n">optional</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">readonly</span><span class="p">)</span> <span class="n">CGFloat</span> <span class="n">ascent</span><span class="p">;</span>
<span class="k">@property</span><span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span><span class="n">readonly</span><span class="p">)</span> <span class="n">CGFloat</span> <span class="n">descent</span><span class="p">;</span>

<span class="err">@</span><span class="n">required</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">renderInContext:</span><span class="p">(</span><span class="n">CGContextRef</span><span class="p">)</span><span class="n">context</span> <span class="nl">rect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="n">rect</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>

<p>The only 2 required methods are <code>-(CGSize&gt;size</code> and <code>-(void)renderInContext:(CGContextRef)context rect:(CGRect)rect</code>, so if we want to draw a simple blue circle, our renderer will be similar to the following implementation:</p>

<div class="highlight"><pre><span class="k">@interface</span> <span class="nc">BlueCircle</span> : <span class="nc">NSObject</span><span class="o">&lt;</span><span class="n">HTMLRenderer</span><span class="o">&gt;</span>
<span class="k">@end</span>
<span class="err">@</span><span class="n">implementation</span> <span class="n">BlueCircle</span>
<span class="o">-</span><span class="p">(</span><span class="n">CGSize</span><span class="p">)</span><span class="n">size</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>  <span class="c1">// make our circle 50x50 points</span>
<span class="p">}</span>
<span class="o">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">renderInContext:</span><span class="p">(</span><span class="n">CGContextRef</span><span class="p">)</span><span class="n">context</span> <span class="nl">rect:</span><span class="p">(</span><span class="n">CGRect</span><span class="p">)</span><span class="n">rect</span>
<span class="p">{</span>
    <span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="p">[</span><span class="n">UIColor</span> <span class="n">blueColor</span><span class="p">].</span><span class="n">CGColor</span><span class="p">);</span>
    <span class="n">CGContextFillEllipseInRect</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">rect</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre></div>

<p>We then use the parser's factory callback to create a new instance of <code>BlueCircle</code>. The new renderer will be retained by the resulting NSAttributedString.</p>

<div class="highlight"><pre><span class="n">m_coreText</span><span class="p">.</span><span class="n">attributedString</span><span class="o">=</span><span class="p">[</span><span class="n">NSAttributedString</span> <span class="nl">attributedStringWithHTML:</span><span class="s">@"Hello &lt;div /&gt; World"</span> <span class="nl">renderer:</span><span class="o">^</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">HTMLRenderer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">NSMutableDictionary</span><span class="o">*</span> <span class="n">attributes</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">BlueCircle</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
<span class="p">}];</span>
</pre></div>

<h1>Setup</h1>

<p>Everything is contained in 2 files only: CoreTextView.mm &amp; CoreTextView.h.</p>

<p>CoreTextView uses ARC. If your project does not use ARC, you'll need to set the following flag for CoreTextView.mm: <code>-fobjc-arc</code> (<a href="http://stackoverflow.com/questions/10523816/how-to-enable-arc-for-a-single-file">How to enable ARC for a single file</a>)</p>

<p>You'll also need to include <code>libxml2.dylib</code> in your project:</p>

<ul>
<li>Link your project against <code>libxml2.dylib</code> and <code>CoreText.framework</code>
</li>
<li>Under your build settings, add the following path under <b>"Header Search Paths"</b>: <code>/usr/include/libxml2</code>
</li>
</ul><h1>Credits</h1>

<p>CoreTextView was created by <a href="https://github.com/giladno">Gilad Novik</a></p>

<p>Many thanks for Oliver Drobnik and his amazing work with <a href="https://github.com/Cocoanetics/DTCoreText">DTCoreText</a>.</p>

<h1>License</h1>

<p>CoreTextView is licensed under <a href="http://opensource.org/licenses/zlib-license.php">zlib</a> license:</p>

<pre><code>Copyright (c) 2013 Gilad Novik

This software is provided 'as-is', without any express or implied warranty. In no event will the authors be held liable for any damages arising from the use of this software.

Permission is granted to anyone to use this software for any purpose, including commercial applications, and to alter it and redistribute it freely, subject to the following restrictions:

1. The origin of this software must not be misrepresented; you must not claim that you wrote the original software. If you use this software in a product, an acknowledgment in the product documentation would be appreciated but is not required.

2. Altered source versions must be plainly marked as such, and must not be misrepresented as being the original software.

3. This notice may not be removed or altered from any source distribution.
</code></pre>

<p>You do not have to mention CoreTextView in your app, but I'll appreciate if you do so anyway (or at least email me to let me know about your new great app :-)  )</p>

<h1>Usage</h1>

<p>Use it, fork it, push updates - enjoy it!</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/giladno/UICoreTextView/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/giladno/UICoreTextView/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/giladno/UICoreTextView"></a> is maintained by <a href="https://github.com/giladno">giladno</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-37728931-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>